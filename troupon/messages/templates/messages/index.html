{% extends "base.html" %}
{% load static %}

{% block custom_css %}
{% endblock %}

{% block main %}
<div class="row">
    <div class="col-sm-12">
        <a href="#" id="compose-btn">Compose <i class="fa fa-chevron-right"></i></a>
    </div>
    <div class="col-sm-6 hidden" id="compose-form">
        <form action="{% url 'send_message' action='new' %}" method="POST">
            {% csrf_token %}
            {% if request.user.is_superuser %}
                <div class="custom-input-group">
                    <select name="recipient">
                        {% for user in users %}
                            <option value="{{user.username}}">{{user.username}}</option>
                        {% endfor %}
                    </select>
                </div>
            {% endif %}
            <div class="custom-input-group">
                <input name="subject" placeholder="Subject" type="text" required="yes">
            </div>
            <div class="custom-input-group">
                <textarea name="body" class="form-control" placeholder="Body Content" required="yes" rows=8></textarea>
            </div>
            <button class="btn btn-action"><i class="fa fa-paper-plane"></i> Send</button>
        </form>
    </div>
</div>


<div class="row">
    {% for letter in messages %}
    <div class="col-sm-12">
        <div class="strip{% if letter.is_unread %} unread{% endif %}">
            <div><strong>{{ letter.sender }}</strong> <span>{{ letter.sent_at }}</span></div>
            <h3><a href="{% url 'read_message' id=letter.id slug=letter.subject|slugify %}">{{ letter.subject }}</a></h3>
            <p>{{ letter.body|truncatewords:8 }}</p>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}

{% block extended_js %}
    <script type="text/javascript" src="{% static 'js/messaging.js' %}"></script>

{% endblock %}

